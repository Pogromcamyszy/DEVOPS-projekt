# Step 1: Use a base image with Linux (Debian)
FROM debian:bullseye-slim

# Step 2: Update package list and install Python and Nginx
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    nginx \
    && rm -rf /var/lib/apt/lists/*

# Step 3: Set up a directory for the application
WORKDIR /app2

# Step 4: Copy your application code (if any) to the container
COPY ./app /app2  

# Step 5: Install Python dependencies (if you have a requirements.txt file)
RUN pip3 install --no-cache-dir -r /app2/req.txt  

# Step 6: Remove the default Nginx site configuration
RUN rm /etc/nginx/sites-enabled/default

# Step 7: Copy the Nginx config file (ensure you have nginx.conf in your context)
COPY ./nginx.conf /etc/nginx/nginx.conf

# Step 8: Expose port 80 for Nginx and the Flask app
EXPOSE 80

# Step 9: Command to start both Flask and Nginx
CMD ["sh", "-c", "python3 /app2/app.py & exec nginx -g 'daemon off;'"]